<h2 id="description">DESCRIPTION</h2>
<p><em>i.landsat8.swlst</em> is an implementation of the robust and practical Slit-Window (SW) algorithm estimating land surface temperature, from the Thermal Infra-Red Sensor (TIRS) aboard Landsat 8 with an accuracy of better than 1.0 K.</p>
<h3 id="details">Details</h3>
<p>A new refinement of the generalized split-window algorithm proposed by Wan (2014) [19] is added with a quadratic term of the difference amongst the brightness temperatures (Ti, Tj) of the adjacent thermal infrared channels, which can be expressed as (equation 2 in the paper [0])</p>
<p><code>LST = b0 + [b1 + b2 * (1-e)/e + b3 * (De/e2)] * (Ti+T)/j2 + [b4 + b5 * (1-e)/e + b6 * (De/e2)] * (Ti-Tj)/2 + b7 * (Ti-Tj)^2</code></p>
<p>where:</p>
<ul>
<li>Ti and Tj are Top of Atmosphere brightness temperatures measured in channels i (~11.0 μm) and j (~12.0 µm), respectively</li>
<li>from http://landsat.usgs.gov/band_designations_landsat_satellites.php:
<ul>
<li>Band 10, Thermal Infrared (TIRS) 1, 10.60-11.19, 100*(30)</li>
<li>Band 11, Thermal Infrared (TIRS) 2, 11.50-12.51, 100*(30)</li>
</ul></li>
<li>e is the average emissivity of the two channels (i.e., <code>e = 0.5 [ei + ej]</code>)</li>
<li>De is the channel emissivity difference (i.e., <code>De = ei - ej</code>)</li>
<li>bk (k = 0,1,...7) are the algorithm coefficients derived from a simulated dataset.</li>
</ul>
<p>[...]</p>
<p>In the above equations,</p>
<ul>
<li>dk (k = 0, 1...6) and ek (k = 1, 2, 3, 4) are the algorithm coefficients;</li>
<li>w is the CWV;</li>
<li>e and De are the average emissivity and emissivity difference of two adjacent thermal channels, respectively, which are similar to Equation (2);</li>
<li>and fk (k = 0 and 1) is related to the influence of the atmospheric transmittance and emissivity, i.e., <code>fk = f(ei, ej, ti, tji)</code>.</li>
</ul>
<p>Note that the algorithm (Equation (6a)) proposed by Jimenez-Munoz et al. added CWV directly to estimate LST.</p>
<p>Rozenstein et al. used CWV to estimate the atmospheric transmittance (ti, tj) and optimize retrieval accuracy explicitly.</p>
<p>Therefore, if the atmospheric CWV is unknown or cannot be obtained successfully, neither of the two algorithms in Equations (6a) and (6b) will work. By contrast, although our algorithm also needs CWV to determine the coefficients, this algorithm still works for unknown CWVs because the coefficients are obtained regardless of the CWV, as shown in Table 1.</p>
<h2 id="notes">NOTES</h2>
<p>The algorithm's flowchart (Figure 3 in the paper [0]) is:</p>
<div class="figure">
<div class="figure">
<img src="Figure_3_Flowchart_of_retrieving_LST_from_Landsat8.jpg">

</div>
</div>
<h3 id="cloud-masking">Cloud Masking</h3>
<p>The first important step of the algorithm is cloud screening. The module offers two ways to achieve this:</p>
<ol style="list-style-type: decimal">
<li>use of the Quality Assessment band and some user-defined QA pixel value</li>
<li>use an external cloud map as an inverted MASK</li>
</ol>
<h3 id="calibration-of-tirs-channels-10-11">Calibration of TIRS channels 10, 11</h3>
<h4 id="conversion-to-spectral-radiance">Conversion to Spectral Radiance</h4>
<p>Conversion of Digital Numbers to TOA Radiance. OLI and TIRS band data can be converted to TOA spectral radiance using the radiance rescaling factors provided in the metadata file:</p>
<p><code>Ll = ML * Qcal + AL</code></p>
<p>where:</p>
<ul>
<li>Ll = TOA spectral radiance (Watts/( m2 * srad * μm))</li>
<li>ML = Band-specific multiplicative rescaling factor from the metadata (RADIANCE_MULT_BAND_x, where x is the band number)</li>
<li>AL = Band-specific additive rescaling factor from the metadata (RADIANCE_ADD_BAND_x, where x is the band number)</li>
<li>Qcal = Quantized and calibrated standard product pixel values (DN)</li>
</ul>
<h4 id="conversion-to-at-satellite-temperature">Conversion to at-Satellite Temperature</h4>
<p>Conversion to At-Satellite Brightness Temperature TIRS band data can be converted from spectral radiance to brightness temperature using the thermal constants provided in the metadata file:</p>
<p><code>T = K2 / ln((K1/Ll) + 1)</code></p>
<p>where:</p>
<ul>
<li>T = At-satellite brightness temperature (K) - Ll = TOA spectral radiance (Watts/( m2 * srad * μm)), below 'DUMMY_RADIANCE'</li>
<li>K1 = Band-specific thermal conversion constant from the metadata (K1_CONSTANT_BAND_x, where x is the band number, 10 or 11)</li>
<li>K2 = Band-specific thermal conversion constant from the metadata (K2_CONSTANT_BAND_x, where x is the band number, 10 or 11) ...</li>
</ul>
<h3 id="land-surface-emissivity">Land Surface Emissivity</h3>
<p>An overview of &quot;Section 3.2: Determination of LSEs&quot;:</p>
<ol style="list-style-type: decimal">
<li><p>The FROM-GLC (30m) contains 10 types of land covers (cropland, forest, grassland, shrubland, wetland, waterbody, tundra, impervious, barren land and snow-ice).</p></li>
<li><p>Deriving emissivities for each land cover class by using different combinations of three BRDF kernel models (geometrical, volumetric and specular models)</p></li>
<li><p>Vegetation and ground emissivity spectra for the BRDF models selected from the MODIS University of California, Santa Barbara (UCSB) Emissivity Library</p></li>
<li><p>Estimating FVC (to obtain emissivity of land cover with temporal variation)) from NDVI based on Carlson (1997) and Sobrino (2001)</p></li>
<li><p>Finally, establishing the average emissivity Look-Up table</p></li>
</ol>
<h3 id="column-water-vapor">Column Water Vapor</h3>
<p>Retrieving atmospheric column water vapor from Landsat8 TIRS data based on the modified split-window covariance and variance ratio (MSWCVR).</p>
<h4 id="modified-split-window-covariance-variance-method">Modified Split-Window Covariance-Variance Method</h4>
<p>With a vital assumption that the atmosphere is unchanged over the neighboring pixels, the MSWCVR method relates the atmospheric CWV to the ratio of the upward transmittances in two thermal infrared bands, whereas the transmittance ratio can be calculated based on the TOA brightness temperatures of the two bands. Considering N adjacent pixels, the CWV in the MSWCVR method is estimated as:</p>
<ul>
<li><code>cwv = c0 + c1*(tj/ti) + c2*(tj/ti)^2</code></li>
<li><code>tj/ti</code> ~ <code>Rji = SUM [(Tik-Ti\_mean) \* (Tjk-Tj\_mean)] / SUM[(Tik-Tj\_mean)\^2]</code></li>
</ul>
<p>In Equation (3a):</p>
<ul>
<li><code>c0</code>, <code>c1</code> and <code>c2</code> are coefficients obtained from simulated data;</li>
<li><code>t</code> is the band effective atmospheric transmittance;</li>
<li><code>N</code> is the number of adjacent pixels (excluding water and cloud pixels) in a spatial window of size <code>n</code> (i.e., <code>N = n × n</code>);</li>
<li><code>Ti,k</code> and <code>Tj,k</code> are top of atmosphere brightness temperatures (K) of bands <code>i</code> and <code>j</code> for the <code>k</code>th pixel;</li>
<li><code>mean(Ti)</code> and <code>mean(Tj)</code> are the mean (or median -- not implemented yet) brightness temperatures of the <code>N</code> pixels for the two bands.</li>
</ul>
<p>The regression coefficients:</p>
<ul>
<li><code>c0</code> = -9.674</li>
<li><code>c1</code> = 0.653</li>
<li><code>c2</code> = 9.087</li>
</ul>
<p>where obtained by:</p>
<ul>
<li>946 cloud-free TIGR atmospheric profiles,</li>
<li>the new high accurate atmospheric radiative transfer model MODTRAN 5.2</li>
<li>simulating the band effective atmospheric transmittance Model analysis indicated that this method will obtain a CWV RMSE of about 0.5 g/cm2.</li>
</ul>
<p>Details about the columnw water vapor retrieval can be found in:</p>
<p>Ren, H.; Du, C.; Qin, Q.; Liu, R.; Meng, J.; Li, J. Atmospheric water vapor retrieval from landsat 8 and its validation. In Proceedings of the IEEE International Geosciene and Remote Sensing Symposium (IGARSS), Quebec, QC, Canada, July 2014; pp. 3045--3048.</p>
<h3 id="land-surface-temperature">Land Surface Temperature</h3>
<p>...</p>
<h4 id="split-window-algorithm">Split-Window Algorithm</h4>
<p>A class implementing the split-window algorithm for Landsat8 imagery Inputs:</p>
<ul>
<li>The class itself requires only a string for 'landcover' which is:
<ol style="list-style-type: decimal">
<li>a fixed land cover class string (one from the classes defined in the FROM-GLC legend)</li>
<li>a land cover class code (integer) one from the classes defined in the FROM-GLC classification scheme.</li>
</ol></li>
<li>Inputs for individual functions vary, look at their definitions.</li>
</ul>
<p>Outputs:</p>
<ul>
<li>Valid expressions for GRASS GIS' r.mapcalc raster processing module</li>
<li>Direct computation for... though not necessary, nor useful for GRASS GIS modules directly?</li>
</ul>
<h5 id="details-1">Details</h5>
<p>The algorithm removes the atmospheric effect through differential atmospheric absorption in the two adjacent thermal infrared channels centered at about 11 and 12 μm. The linear or non-linear combination of the brightness temperatures is finally applied for LST estimation based on the equation:</p>
<p><code>LST = b0 + + (b1 + b2 \* ((1-ae)/ae)) + + b3 \* (de/ae) \* ((t10 + t11)/2) + + (b4 + b5 \* ((1-ae)/ae) + b6 \* (de/ae\^2)) \* ((t10 - t11)/2) + + b7 \* (t10 - t11)\^2</code></p>
<p>To reduce the influence of the CWV error on the LST, for a CWV within the overlap of two adjacent CWV sub-ranges, we first use the coefficients from the two adjacent CWV sub-ranges to calculate the two initial temperatures and then use the average of the initial temperatures as the pixel LST.</p>
<p>For example, the LST pixel with a CWV of 2.1 g/cm2 is estimated by using the coefficients of [0.0, 2.5] and [2.0, 3.5]. This process initially reduces the delta-LSTinc and improves the spatial continuity of the LST product.</p>
<h2 id="example">EXAMPLE</h2>
<p>At minimum, the module requires the following in order to derive a land surface temperature map:</p>
<ol style="list-style-type: decimal">
<li><p>The Landsat8 scene's acquisition metadata (MTL file)</p></li>
<li><p>Bands 10, 11 and QA</p></li>
<li><p>A FROM-GLC product for the same Path and Row as the Landsat scene to be processed</p></li>
</ol>
<p>The shortest call for processing a complete Landsat8 scene normally is:</p>
<div class="code">
<pre><code>i.landsat8.swlst mtl=MTL prefix=B landcover=FROM_GLC</code></pre>
</div>
<p>where:</p>
<ul>
<li>mtl= the name of the MTL metadata file (normally with a &quot;.txt&quot; extension)</li>
<li>prefix= the prefix of the band names imported in GRASS GIS' data base</li>
<li>landcover= the name of the FROM-GLC map that covers the extent of the Landsat8 scene under processing</li>
</ul>
<p>The pixel value 61440 is selected to automatically to build a cloud mask. At the moment, only one pixel value may be requested from the Quality Assessment band. For details, refer to [http://landsat.usgs.gov/L8QualityAssessmentBand.php USGS' webpage for Landsat8 Quality Assessment Band]</p>
<p>In order to restrict the processing in to the currently set computational region, the <em>-k</em> flag can be used:</p>
<div class="code">
<pre><code>i.landsat8.swlst mtl=MTL prefix=B landcover=FROM_GLC -k </code></pre>
</div>
<p>A user defined map for clouds, instead of relying on the Quality Assessment band, can be used via the <code>clouds</code> option:</p>
<div class="code">
<pre><code>i.landsat8.swlst mtl=MTL prefix=B landcover=FROM_GLC clouds=Cloud_Map -k </code></pre>
</div>
<p>The Celsius color table may be applied for the output land surface temperature map via the <em>-c</em> flag:</p>
<div class="code">
<pre><code>i.landsat8.swlst mtl=MTL prefix=B landcover=FROM_GLC -c </code></pre>
</div>
<p>The user can use existing at-satellite temperature maps via the <code>t10</code> and <code>t11</code> options, selectively. For example:</p>
<div class="code">
<pre><code>i.landsat8.swlst mtl=MTL b10=B10 t11=AtSatellite_Temperature_11 landcover=FROM_GLC -c </code></pre>
</div>
<p>or</p>
<div class="code">
<pre><code>i.landsat8.swlst mtl=MTL t10=AtSatellite_Temperature_10 t11=AtSatellite_Temperature_11 landcover=FROM_GLC -c </code></pre>
</div>
<p>Expert users may need to request for a &quot;fixed&quot; average surface emissivity, in order to perform the algorithm for a single land cover class (one from the classes defined in the FROM-GLC classification scheme) via the <code>emissivity\_class</code> option. Consequently, <code>emissivity\_class</code> cannot be used at the same time with the <code>landover</code> option.</p>
<div class="code">
<pre><code>i.landsat8.swlst mtl=MTL b10=B10 t11=AtSatellite_Temperature_11 qab=BQA emissivity_class=&quot;Croplands&quot; -c </code></pre>
</div>
<p>A complete &quot;transparent&quot; run-through of what kind of and how the module performs its computations, may be requested via the use of both the <em>--v</em> and <em>-i</em> flags:</p>
<div class="code">
<pre><code>i.landsat8.swlst mtl=MTL prefix=B landcover=FROM_GLC -i --v </code></pre>
</div>
<p>The above will print out a description of each individual processing step, as well as the actual mathematical epxressions applied via GRASS GIS' <code>r.mapcalc</code> module.</p>
<div class="code">
<pre><code>i.landsat8.swlst</code></pre>
</div>
<div class="figure">
<div class="figure">
<img src=".jpg">

</div>
</div>
<p>...</p>
<div class="code">
<pre><code>i.landsat8.swlst</code></pre>
</div>
<div class="figure">
<div class="figure">
<img src=".jpg">

</div>
</div>
<h2 id="todo">TODO</h2>
<ul>
<li>Go through <a href="http://trac.osgeo.org/grass/wiki/Submitting/Python">Submitting Python</a></li>
<li>Proper command history tracking.</li>
<li>Add timestamps (r.timestamp, temporal framework)</li>
<li>Deduplicate code where applicable</li>
<li>Test if it compiles in other systems</li>
<li>Improve documentation</li>
</ul>
<h2 id="references">REFERENCES</h2>
<ul>
<li><p>[0] Du, Chen; Ren, Huazhong; Qin, Qiming; Meng, Jinjie; Zhao, Shaohua. 2015. &quot;A Practical Split-Window Algorithm for Estimating Land Surface Temperature from Landsat 8 Data.&quot; Remote Sens. 7, no. 1: 647-665. http://www.mdpi.com/2072-4292/7/1/647/htm#sthash.ba1pt9hj.dpuf</p></li>
<li><p>[1] Huazhong Ren, Chen Du, Qiming Qin, Rongyuan Liu, Jinjie Meng, and Jing Li. &quot;Atmospheric Water Vapor Retrieval from Landsat 8 and Its Validation.&quot; 3045--3048. IEEE, 2014.</p></li>
</ul>
<h2 id="see-also">SEE ALSO</h2>
<p><em><a href="i.emissivity.html">i.emissivity</a></em></p>
<h2 id="authors">AUTHORS</h2>
Nikos Alexandris
<p>
